<div class="contract-doc"><div class="contract"><h2 class="contract-header"><span class="contract-kind">contract</span> ProposalStateTransitioner</h2><p class="base-contracts"><span>is</span> <a href="https://github.com/mixbytes/renderhash/blob/master/blockchain/docs/api_Proposal_ProposalStateDataTransferer.md">ProposalStateDataTransferer</a></p><p class="description">Abstract contract that incapsulates states, state transitions and requirements of these transitions. Uses state variables from <a href="https://github.com/mixbytes/renderhash/blob/master/blockchain/docs/api_Proposal_ProposalStateDataTransferer.md">ProposalStateDataTransferer</a>.</p><div class="source">Source: <a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L40" target="_blank">contracts/Proposal.sol</a></div></div><div class="index"><h2>Index</h2><ul><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L59">ProposalCloseWasCalledBy</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L57">ProposalDisputeStarted</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L56">ProposalTaskWasDone</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L55">ProposalWasPrepaid</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L58">ProposalWasResolved</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L54">ResponseToProposalWasReceived</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L126">announceTaskCompleted</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L231">changeStateTo</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L215">closeProposal</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L42">onlyParties</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L100">pushToPrepaidState</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L186">resolveDispute</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L70">responseToProposal</a></li><li><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L156">startDispute</a></li></ul></div><div class="reference"><h2>Reference</h2><div class="events"><h3>Events</h3><ul><li><div class="item event"><span id="ProposalCloseWasCalledBy" class="anchor-marker"></span><h4 class="name">ProposalCloseWasCalledBy</h4><div class="body"><code class="signature">event <strong>ProposalCloseWasCalledBy</strong><span>(address who, States currentState) </span></code><hr/><span>Emitted when one of allowed parties (customer, contractor, arbiter) closes proposal.</span><dl><li><div class="item event"><span id="ProposalDisputeStarted" class="anchor-marker"></span><h4 class="name">ProposalDisputeStarted</h4><div class="body"><code class="signature">event <strong>ProposalDisputeStarted</strong><span>(uint256 newAmount) </span></code><hr/><span>Emitted when customer disagree with contractors task results. Event parameter is a new amount of reward customer would like to pay.</span><dl><li><div class="item event"><span id="ProposalTaskWasDone" class="anchor-marker"></span><h4 class="name">ProposalTaskWasDone</h4><div class="body"><code class="signature">event <strong>ProposalTaskWasDone</strong><span>(uint256 when, bytes solution) </span></code><hr/><span>Emitted by contractor to inform that the task was done.</span><dl><li><div class="item event"><span id="ProposalWasPrepaid" class="anchor-marker"></span><h4 class="name">ProposalWasPrepaid</h4><div class="body"><code class="signature">event <strong>ProposalWasPrepaid</strong><span>(uint256 contractorReward, uint256 arbiterReward) </span></code><hr/><span>Emitted when customer locks (prepays) arbiters and customers tokens on the proposal.</span><li><div class="item event"><span id="ProposalWasResolved" class="anchor-marker"></span><h4 class="name">ProposalWasResolved</h4><div class="body"><code class="signature">event <strong>ProposalWasResolved</strong><span>(bytes solutionHash) </span></code><hr/><span>Emitted when arbiter resolves dispute. Event parameter is an IPFS hash reference to arbiters decision info.</span><dl><li><div class="item event"><span id="ResponseToProposalWasReceived" class="anchor-marker"></span><h4 class="name">ResponseToProposalWasReceived</h4><div class="body"><code class="signature">event <strong>ResponseToProposalWasReceived</strong><span>(uint64 deadline, uint256 reward) </span></code><hr/><dl><span>Emitted when contractor suggests task deadline and reward for the done task withing the deadline.</span></ul></div><div class="modifiers"><h3>Modifiers</h3><ul><li><div class="item modifier"><span id="onlyParties" class="anchor-marker"></span><h4 class="name">onlyParties</h4><div class="body"><code class="signature">modifier <strong>onlyParties</strong><span>() </span></code><hr/></div></div></li></ul></div><div class="functions"><h3>Functions</h3><ul><li><div class="item function"><span id="responseToProposal" class="anchor-marker"></span><h4 class="name">responseToProposal</h4><div class="body"><code class="signature">function <strong>responseToProposal</strong><span>(uint64 contractorDeadline, uint256 contractorReward) </span><span>external </span></code><hr/><div class="description"><p>The function can be called from two STATES - `INIT` and `PROPOSED`. The function is called by `contractor` to push state forward to `PROPOSED` and define proposal base configurations like: deadline, reward for work. `PROPOSED` requires setting results of negotiations between `customer` and `contractor`.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>contractorDeadline</code> - task deadline, after which reward payouts are unavailable</div><div><code>contractorReward</code> - reward amount which contractor gets if task was done within deadline and without any disagreements from customer.</div></dd></dl></div></div></li><li><div class="item function"><span id="pushToPrepaidState" class="anchor-marker"></span><h4 class="name">pushToPrepaidState</h4><div class="body"><code class="signature">function <strong>pushToPrepaidState</strong><span>() </span><span>external </span></code><hr/><div class="description"><p>The function performs external call, after which <a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L20">_stateTransitionDeadline</a> is set. That is the first time _stateTransitionDeadline is modified. The function is called only from `PROPOSED`. Generally, the function is called by customer to lock rewards for arbiter and contractor on the proposal <a href="https://github.com/mixbytes/renderhash/blob/94cf33ab763c730c9d652db0fbb661487f1e70ed/blockchain/contracts/Proposal.sol#L16">token</a> balance. As a result of the function call contracts <a href="https://github.com/mixbytes/renderhash/blob/94cf33ab763c730c9d652db0fbb661487f1e70ed/blockchain/contracts/Proposal.sol#L52">currentState</a> will be set to `PREPAID`. Setting proposal to `PREPAID` is a signal for contractor to start performing task. To be more accurate, the function increases _stateTransitionDeadline value to `now + 24 hours`. This deadline states interval within which customer can cancel proposal <a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L215">closeProposal</a> and receive back locked tokens. When _stateTransitionDeadline expires, contractor can begin doing task without any concerns. An important thing to mention: customer should approve respected amount of tokens to be taken from him.</p></div></div></div></li><li><div class="item function"><span id="announceTaskCompleted" class="anchor-marker"></span><h4 class="name">announceTaskCompleted</h4><div class="body"><code class="signature">function <strong>announceTaskCompleted</strong><span>(bytes doneTaskHash) </span><span>external </span></code><hr/><div class="description"><p>The function is called by contractor. It signals that the task was completed. If customer does not react with <a href="https://github.com/mixbytes/renderhash/blob/94cf33ab763c730c9d652db0fbb661487f1e70ed/blockchain/contracts/Proposal.sol#L156">startDispute</a> within 24 hours from the timestamp when the function was called, then proposal can be closed with reward payouts for contractor. In this case, customer receives back arbiter token reward. The function can&#x27;t be called until <a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L20">_stateTransitionDeadline</a> from <a href="https://github.com/mixbytes/renderhash/blob/94cf33ab763c730c9d652db0fbb661487f1e70ed/blockchain/contracts/Proposal.sol#L100">pushToPrepaidState</a> call is expired. _stateTransitionDeadline is modified the second time when the function is called. A new _stateTransitionDeadline defines deadline within which startDispute can be called and after which <a href="https://github.com/mixbytes/renderhash/blob/94cf33ab763c730c9d652db0fbb661487f1e70ed/blockchain/contracts/Proposal.sol#L215">closeProposal</a> is available. Called only from `PREPAID`. </p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>doneTaskHash</code> - IPFS hash of the task result. This value is not stored in storage, it is just emitted. So parse `ProposalTaskWasDone` events to use these values in your app.</div></dd></dl></div></div></li><li><div class="item function"><span id="startDispute" class="anchor-marker"></span><h4 class="name">startDispute</h4><div class="body"><code class="signature">function <strong>startDispute</strong><span>(uint256 newRewardToPay) </span><span>external </span></code><hr/><div class="description"><p>Generally, the function is called by customer within secondly modified <a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L20">_stateTransitionDeadline deadline</a> to show customers disagreement on task results. Accepts `newRewardToPay` argument that can be taken into account by arbiter when he calls <a href=https://github.com/mixbytes/renderhash/blob/94cf33ab763c730c9d652db0fbb661487f1e70ed/blockchain/contracts/Proposal.sol#L186>resolveDispute</a> function. If arbiter does not show up within 24 hours from the function call, then <a href="https://github.com/mixbytes/renderhash/blob/94cf33ab763c730c9d652db0fbb661487f1e70ed/blockchain/contracts/Proposal.sol#L215">closeProposal</a> can be called. Some comments for developers: the function modifies thirdly _stateTransitionDeadline deadline and as was stated previously, the _stateTransitionDeadline modification defines deadline for resolveDispute function call by arbiter. Called only from `COMPLETED`.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>newRewardToPay</code> - &quot;disputed&quot; reward that `customer` thinks to be fair as a payout for done task. This value is just emitted, so an application should parse event logs to get it.</div></dd></dl></div></div></li><li><div class="item function"><span id="resolveDispute" class="anchor-marker"></span><h4 class="name">resolveDispute</h4><div class="body"><code class="signature">function <strong>resolveDispute</strong><span>(uint256 disputedReward, bytes arbiterSolution) </span><span>external </span></code><hr/><div class="description"><p>The function is called by arbiter within thirdly modified <a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L20">_stateTransitionDeadline</a> deadline to resolve dispute and execute fair (in accordance to arbiters opinion) payouts. `disputedReward` can be lt <a href="https://github.com/mixbytes/renderhash/blob/master/blockchain/docs/api_Proposal_ProposalStateDataTransferer.md">contractorTokenReward</a>, so differece between these amounts will be send back to customer. Also arbiter gets <a href="https://github.com/mixbytes/renderhash/blob/master/blockchain/docs/api_Proposal_ProposalStateDataTransferer.md">arbiterTokenReward`</a> for dispute resolve. From 2 to 3 external calls to <a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L16">proposalCurrencyToken</a> can be executed. After token transfers `selfdestruct` is executed. Called only from `DISPUTE`. </p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>disputedReward</code> - `arbiter` decision on `contractor` reward for the done task. This amount of tokens will be send to `contractor`.</div><div><code>arbiterSolution</code> - IPFS hash reference to arbiters solition data.</div></dd></dl></div></div></li><li><div class="item function"><span id="closeProposal" class="anchor-marker"></span><h4 class="name">closeProposal</h4><div class="body"><code class="signature">function <strong>closeProposal</strong><span>() </span><span>external </span></code><hr/><div class="description"><p>Calls from `PREPAID`, `COMPLETED`, `DISPUTE` states execute <a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L16">proposalCurrencyToken</a> transfers. `selfdestruct` is called after transfer executions. The function can be called from `INIT`, `PROPOSED`, `PREPAID`, `COMPLETED` and `DISPUTE` states. `INIT` and `PROPOSED` states allow calling the function any time it is necessary for parties. Call conditionals from other states are defined in respected functions. Parties are stated in `onlyParties` modifier.</p></div><dl><dt><span class="label-modifiers">Modifiers:</span></dt><dd><a href="https://github.com/mixbytes/renderhash/blob/03a802135c04ca2e3296b8ef0c6feb954f45c838/blockchain/contracts/Proposal.sol#L42">onlyParties </a></dd></dl></div></div></li><li><div class="item function"><span id="changeStateTo" class="anchor-marker"></span><h4 class="name">changeStateTo</h4><div class="body"><code class="signature"><span>abstract </span>function <strong>changeStateTo</strong><span>(States nextState, uint64 newDeadline, uint256 contractorReward, uint256 disputedRewardAmount) </span><span>internal </span></code><hr/><div class="description"><p>Abstract. Implemented in main Proposal contract.</p></div><dl></dl></div></div></li></ul></div></div></div>
